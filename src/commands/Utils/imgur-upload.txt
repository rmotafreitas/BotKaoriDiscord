const { Client, Message, MessageEmbed } = require("discord.js");
const imgur = require("imgur-anonymous-uploader");
const id = require("../../config.json").imgurId;

module.exports = {
  name: "imgur-upload",
  cooldown: 3,
  /**
   * @param {Client} client
   * @param {Message} message
   * @param {String[]} args
   */
  run: async (client, message, args) => {
    function isImg(query) {
      if (query.toLowerCase().match(/\.(jpg|png)/g)) return true;
      return false;
    }
    const query = args.join(" ");
    if (!query) return message.inlineReply("Please provide a link to an image");
    if (!isImg(query)) return message.inlineReply("That's not a link to a image must end with (png OR jpg)");

    (async () => {
        try {
          const uploader = new ImgurAnonymousUploader(id);
          const uploadResponse = await uploader.upload(query);
          message.inlineReply("Here is the image: " + uploadResponse.url);
          /*
            {
              success: true,
              status: 200,
              url: 'uploaded imgur url',
              deleteHash: 'delete hash'
            }
          */
      
          await uploader.delete(query);
        } catch (error) {
          return message.inlineReply("Something went wrong!")
        }
      })();
  },
};
